{% extends "base.html" %}

{% block page_styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stylesempresas.css') }}">
{% endblock %}

{% block content %}
<div class="crud-container-single">
    <div class="form-section">
        <div class="form-header">
            <h2>Editando Empresa: {{ empresa.nombre_empresa }}</h2>
            <p>Modifica la información y las reglas de negocio de la empresa.</p>
        </div>
        
        <form action="{{ url_for('main.editar_empresa', id=empresa.id) }}" method="POST" class="crud-form">
            <div class="form-group">
                <label for="nombre_empresa">Nombre de la Empresa</label>
                <input type="text" id="nombre_empresa" name="nombre_empresa" value="{{ empresa.nombre_empresa }}" required>
            </div>

            <fieldset>
                <legend>Cargos por Servicio</legend>
                 <div class="form-group">
                    <label for="cargoServicioFacturado">Monto del Cargo (Visible/Facturado)</label>
                    {# Buscamos de forma segura el cargo de tipo 'visible' #}
                    {% set cargo_visible = empresa.cargos_servicio|selectattr('tipo', 'equalto', 'visible')|first %}
                    <input type="number" step="0.01" id="cargoServicioFacturado" name="cargoServicioFacturado" value="{{ cargo_visible.monto if cargo_visible else '' }}">
                </div>
                 <div class="form-group">
                    <label for="cargoServicioOculto">Monto del Cargo (Oculto/Agregado)</label>
                    {# Buscamos de forma segura el cargo de tipo 'oculto' #}
                    {% set cargo_oculto = empresa.cargos_servicio|selectattr('tipo', 'equalto', 'oculto')|first %}
                    <input type="number" step="0.01" id="cargoServicioOculto" name="cargoServicioOculto" value="{{ cargo_oculto.monto if cargo_oculto else '' }}">
                </div>
            </fieldset>

            <fieldset>
                <legend>Descuentos</legend>
                <div class="form-group">
                    <label for="montoDescuento">Monto Fijo de Descuento</label>
                    {# CORRECCIÓN: Usamos el filtro 'first' para obtener el primer descuento de forma segura #}
                    {% set descuento = empresa.descuentos|first %}
                    <input type="number" step="0.01" id="montoDescuento" name="montoDescuento" value="{{ descuento.valor if descuento else '' }}">
                </div>
            </fieldset>
            
            <fieldset>
                <legend>Tarifas</legend>
                 <div class="form-group">
                    <label for="tarifaFija">Tarifa Fija</label>
                    {# CORRECCIÓN: Usamos el filtro 'first' para obtener la primera tarifa de forma segura #}
                    {% set tarifa = empresa.tarifas_fijas|first %}
                    <input type="number" step="0.01" id="tarifaFija" name="tarifaFija" value="{{ tarifa.monto if tarifa else '' }}">
                </div>
            </fieldset>
            
            <div class="form-actions">
                <button type="submit" class="btn-submit">Guardar Cambios</button>
                <a href="{{ url_for('main.empresas') }}" class="btn-cancel">Cancelar</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

