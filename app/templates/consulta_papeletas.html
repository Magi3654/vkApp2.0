{% extends "base.html" %}

{% block page_styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stylespapeletas.css') }}">
{% endblock %}

{% block content %}
<div class="papeletas-container">
    <div class="page-header">
        <h2>ğŸ“‹ Papeletas Registradas</h2>
        <a href="{{ url_for('main.nueva_papeleta_form') }}" class="btn-new">+ Nueva Papeleta</a>
    </div>
    
    {% if papeletas_por_tarjeta %}
        {% for tarjeta, papeletas in papeletas_por_tarjeta.items() %}
        <div class="tarjeta-group">
            <div class="tarjeta-header">
                <div class="tarjeta-info-header">
                    <span class="tarjeta-icon">ğŸ’³</span>
                    <div class="tarjeta-details">
                        <h3>{{ tarjeta.nombre if tarjeta.nombre else 'Tarjeta ' + tarjeta.numero }}</h3>
                        <span class="tarjeta-numero">**** {{ tarjeta.numero }}</span>
                        {% if tarjeta.banco %}
                            <span class="tarjeta-banco">{{ tarjeta.banco }}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="tarjeta-stats">
                    <span class="stat-badge">{{ papeletas|length }} papeleta{{ 's' if papeletas|length > 1 else '' }}</span>
                    <span class="stat-total">${{ "%.2f"|format(papeletas|sum(attribute='total_ticket')|float) }}</span>
                </div>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Folio</th>
                        <th>Fecha</th>
                        <th>Facturar a</th>
                        <th>AerolÃ­nea/Proveedor</th>
                        <th>Total Ticket</th>
                        <th>Creado por</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for papeleta in papeletas %}
                    <tr>
                        <td><strong>{{ papeleta.folio }}</strong></td>
                        <td>{{ papeleta.fecha_venta.strftime('%d/%m/%Y') if papeleta.fecha_venta else '---' }}</td>
                        <td>{{ papeleta.facturar_a }}</td>
                        <td>
                            {% if papeleta.aerolinea %}
                                âœˆï¸ {{ papeleta.aerolinea.nombre }}
                            {% elif papeleta.proveedor %}
                                ğŸ“ {{ papeleta.proveedor }}
                            {% else %}
                                ---
                            {% endif %}
                        </td>
                        <td class="monto">${{ "%.2f"|format(papeleta.total_ticket|float) }}</td>
                        <td>{{ papeleta.usuario.nombre }}</td>
                        <td class="actions">
                            <a href="{{ url_for('main.editar_papeleta', id=papeleta.id) }}" class="btn-edit">Editar</a>
                            <a href="{{ url_for('main.eliminar_papeleta', id=papeleta.id) }}" class="btn-delete" onclick="return confirm('Â¿Eliminar papeleta {{ papeleta.folio }}?')">Eliminar</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“­</div>
            <h3>No hay papeletas registradas</h3>
            <p>Comienza agregando una nueva papeleta.</p>
            <a href="{{ url_for('main.nueva_papeleta_form') }}" class="btn-new">+ Crear Primera Papeleta</a>
        </div>
    {% endif %}
</div>
{% endblock %}